<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CR SIM</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <main class="page">
    <header>
      <h1>CR sim for decentralized sequencers</h1>
      <p>Defaults replicate current Aztec mainnet config. Adjust config and recompute.</p>
    </header>

    <section class="panel">
      <h2>Config</h2>
      <form id="config-form" class="grid">
        <label>base_sequencers
          <input name="base_sequencers" type="number" min="0" step="1" required>
        </label>
        <label>stake_per_sequencer_token
          <input name="stake_per_sequencer_token" type="number" min="1" step="1" required>
        </label>
        <label>token_usd
          <input name="token_usd" type="number" min="0.0000001" step="any" required>
        </label>
        <label>censor_fraction
          <input name="censor_fraction" type="number" min="0" max="1" step="any" required>
        </label>
        <label>committee_size
          <input name="committee_size" type="number" min="1" step="1" required>
        </label>
        <label>slot_seconds
          <input name="slot_seconds" type="number" min="1" step="1" required>
        </label>
        <label>max_horizon_days
          <input name="max_horizon_days" type="number" min="1" step="1" required>
        </label>
        <label>epoch_slots
          <input name="epoch_slots" type="number" min="1" step="1" required>
        </label>
        <label>max_new_sequencers_per_epoch
          <input name="max_new_sequencers_per_epoch" type="number" min="1" step="1" required>
        </label>
        <label>probability_near_one_margin
          <input name="probability_near_one_margin" type="number" min="0.000000001" max="0.999999999" step="any" required>
        </label>
      </form>
      <div class="actions">
        <button id="run-btn" type="button">Run Simulation</button>
        <button id="reset-btn" type="button">Reset Defaults</button>
        <button id="csv-btn" type="button">Download CSV</button>
      </div>
      <p id="status" class="status">Ready.</p>
      <p id="summary" class="summary"></p>
    </section>

    <section class="panel">
      <h2>Cumulative Inclusion Over Time</h2>
      <div id="chart-cumulative" class="chart-wrap"></div>
      <p class="note">X-axis shows elapsed days with derived invested stake and user sequencer count in tick labels. Range expands until both curves reach 1 - probability_near_one_margin, bounded by max_horizon_days.</p>
    </section>

    <section class="panel">
      <h2>Per-slot Inclusion</h2>
      <div id="chart-per-slot" class="chart-wrap"></div>
      <p class="note">Per-slot chart spans the full max_horizon_days range.</p>
    </section>

    <section class="panel">
      <h2>Inclusion Delay</h2>
      <div id="chart-delay" class="chart-wrap"></div>
      <p class="note">Delay chart x-range uses the full max_horizon_days sequencer range. Y-axis is capped at 30 days (720h); values above the cap are hidden.</p>
    </section>
  </main>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
