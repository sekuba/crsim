<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CR SIM</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <main class="page">
    <header>
      <h1>CR sim for decentralized sequencers</h1>
      <p>Defaults replicate current Aztec mainnet config. Adjust config and recompute.</p>
    </header>

    <section class="t90-strip" aria-live="polite">
      <article class="t90-card t90-card-non">
        <p class="t90-label">Non-committee T90</p>
        <p id="t90-non-value" class="t90-value">-</p>
      </article>
      <article class="t90-card t90-card-committee">
        <p class="t90-label">Committee T90</p>
        <p id="t90-committee-value" class="t90-value">-</p>
      </article>
    </section>
    <p class="t90-help">
      time until cumulative inclusion probability reaches 90% for a submitted transaction in the committee or non-committee scenario with the current configuration.
    </p>

    <details class="panel config-panel">
      <summary>
        <span class="config-title">Config</span>
        <span class="config-hint">show/hide</span>
      </summary>
      <div class="config-body">
        <form id="config-form" class="grid config-grid">
          <label><span>Base sequencers</span>
            <input name="base_sequencers" type="number" min="0" step="1" required>
            <small>sequencer count at the start of the sim</small>
          </label>
          <label><span>Stake / sequencer (token)</span>
            <input name="stake_per_sequencer_token" type="number" min="1" step="1" required>
            <small>tokens needed to add 1 sequencer</small>
          </label>
          <label><span>Token USD</span>
            <input name="token_usd" type="number" min="0.0000001" step="any" required>
            <small>1 token price in USD</small>
          </label>
          <label><span>Censor fraction</span>
            <input name="censor_fraction" type="number" min="0" max="1" step="any" required>
            <small>init share censoring sequencers</small>
          </label>
          <label><span>Committee size</span>
            <input name="committee_size" type="number" min="1" step="1" required>
            <small>sequencers per committee</small>
          </label>
          <label><span>Slot seconds</span>
            <input name="slot_seconds" type="number" min="1" step="1" required>
            <small>smallest 'block' unit proposable</small>
          </label>
          <label><span>Max horizon days</span>
            <input name="max_horizon_days" type="number" min="0.000001" step="any" required>
            <small>max simulation window</small>
          </label>
          <label><span>Epoch slots</span>
            <input name="epoch_slots" type="number" min="1" step="1" required>
            <small>committee reign period</small>
          </label>
          <label><span>Max new sequencers / epoch</span>
            <input name="max_new_sequencers_per_epoch" type="number" min="1" step="1" required>
            <small>entry churn rate</small>
          </label>
          <label><span>Honest add success rate</span>
            <input name="honest_add_success_rate" type="number" min="0.000001" max="1" step="any" required>
            <small>honest share of sequencer adds</small>
          </label>
          <label><span>Probability near-one margin</span>
            <input name="probability_near_one_margin" type="number" min="0.000000001" max="0.999999999" step="any" required>
            <small>near-100% cutoff</small>
          </label>
        </form>
        <div class="actions">
          <button id="run-btn" type="button">Run</button>
          <button id="reset-btn" type="button">Reset</button>
          <button id="csv-btn" type="button">dl CSV</button>
        </div>
        <p id="status" class="status">Ready.</p>
        <p id="summary" class="summary"></p>
      </div>
    </details>

    <section class="panel">
      <h2>Cumulative Inclusion Over Time</h2>
      <div id="chart-cumulative" class="chart-wrap"></div>
      <p class="note">X-axis range expands until both curves reach 1 - probability_near_one_margin, bounded by max_horizon_days.</p>
    </section>

    <section class="panel">
      <h2>Per-slot Inclusion</h2>
      <div id="chart-per-slot" class="chart-wrap"></div>
      <p class="note">X-axis uses the full max_horizon_days range.</p>
    </section>

    <section class="panel">
      <h2>Inclusion Delay</h2>
      <div id="chart-delay" class="chart-wrap"></div>
      <p class="note">X-axis uses the full max_horizon_days range, with ticks showing USD, user sequencer count, and derived onboarding time. Y-axis is capped at 30 days (720h); values above the cap are hidden.</p>
    </section>
  </main>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
